{% extends "base.html" %}

{% block content %}
<div class="combine-config">
    <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card mdl-shadow--2dp form-card">
                <div class="mdl-card__title">
                    <h2 class="mdl-card__title-text">Combine Configurations</h2>
                </div>
                <div class="mdl-card__supporting-text">
                    <!-- Drag & Drop Area with hidden file input -->
                    <div class="file-upload-area" id="combineDropZone">
                        <i class="material-icons">cloud_upload</i>
                        <p>Drag & drop .mydre files here or click to select files</p>
                    </div>
                    <input type="file" id="combineFileInput" accept=".mydre" multiple>

                    <!-- Files List -->
                    <div id="combineFilesList" class="files-list"></div>

                    <!-- Workspaces Grid -->
                    <div id="workspacesGrid" class="workspaces-grid" style="display: none;">
                        <h3>Workspaces to Combine</h3>
                        <div class="mdl-grid grid-header">
                            <div class="mdl-cell mdl-cell--5-col">Workspace Name</div>
                            <div class="mdl-cell mdl-cell--5-col">Uploader Name</div>
                            <div class="mdl-cell mdl-cell--2-col">Actions</div>
                        </div>
                        <div id="workspacesList"></div>
                    </div>

                    <!-- Combine Form -->
                    <div id="combineForm" class="combine-form" style="display: none;">
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <input class="mdl-textfield__input" type="password" id="combinePin" pattern=".{6,}">
                            <label class="mdl-textfield__label" for="combinePin">Enter PIN (min. 6 characters)</label>
                            <span class="mdl-textfield__error">PIN must be at least 6 characters long</span>
                        </div>
                        
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <input class="mdl-textfield__input" type="text" id="combineFileName" value="combined_keys.mydre">
                            <label class="mdl-textfield__label" for="combineFileName">File Name</label>
                        </div>

                        <button id="combineButton" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                            Combine and Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- PIN Dialog -->
<dialog class="mdl-dialog" id="pinDialog">
    <h4 class="mdl-dialog__title">Enter PIN</h4>
    <div class="mdl-dialog__content">
        <p>Enter PIN for file: <span id="currentFileName"></span></p>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" type="password" id="filePin" pattern=".{6,}">
            <label class="mdl-textfield__label" for="filePin">PIN (minimum 6 characters)</label>
        </div>
    </div>
    <div class="mdl-dialog__actions">
        <button type="button" class="mdl-button" id="decryptButton">Decrypt</button>
        <button type="button" class="mdl-button close" id="cancelButton">Cancel</button>
    </div>
</dialog>
{% endblock %} 

{% block page_scripts %}
    <script src="{{ url_for('static', path='/js/combine-form.js') }}"></script>
{% endblock %} 